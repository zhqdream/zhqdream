<!DOCTYPE html><html style="height: 100%"><head>    <meta charset="utf-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">    <link rel="shortcut icon" href="__STATIC__/adv/img/reglink.ico">    <link href="__STATIC__/adv/css/bootstrap.min.css?v=3.3.6" rel="stylesheet">    <link href="__STATIC__/adv/css/plugins/chosen/chosen.css" rel="stylesheet">    <link href="__STATIC__/adv/css/style.css?v=4.1.0" rel="stylesheet"></head><body style="height: 100%; margin: 0"><div id="container" style="height: 100%"></div><div id="container1" style="position:absolute; top:65%; left:75%; width: 300px;height: 250px;"></div><div class="wrapper wrapper-content animated fadeInRight" style="position:absolute; top:0; left:20%;padding: 10px;opacity:0.7;">        <div class="col-sm-4" style="width: 100%">            <div class="ibox float-e-margins">                <div class="ibox-title" style="background-color:#404a59;color: #ccc">                    <h5>条件筛选</h5>                </div>                <div class="ibox-content" style="background-color:#404a59;">                    {if condition="$role_id == 1"}                    <div class="form-group">                        <label class="font-noraml" style="color: #ccc">选择厂商</label>                        <div class="input-group">                            <select data-placeholder="选择厂商" id="selcustomer" class="chosen-select" onchange="getmanulist()" style="width: 200px;" tabindex="2">                                <option value="">请选择厂商</option>                                {volist name="$customerlist" id="cus_list"}                                <option value="{$cus_list.id}" hassubinfo="true" {if condition="$customer_text == $cus_list.customer_name"} selected {/if}>{$cus_list.customer_name}</option>                                {/volist}                            </select>                        </div>                    </div>                    <div class="form-group">                        <label class="font-noraml" style="color: #ccc">选择型号</label>                        <div class="input-group">                            <select data-placeholder="选择型号" id="selmanu" class="chosen-select" style="width: 200px;" multiple tabindex="4">                            </select>                        </div>                    </div>                    {else/}                    <div class="form-group">                        <label class="font-noraml" style="color: #ccc">选择型号</label>                        <div class="input-group">                            <select data-placeholder="选择型号" id="selmanu" class="chosen-select" style="width: 200px;" multiple tabindex="4">                                {volist name="$channel" id="channellist"}                                <option value="{$channellist.customer}" hassubinfo="true" {volist name="$commonchannel" id="commonlist"} {if condition="$channellist.customer == $commonlist"} selected {/if} {/volist}>{$channellist.customer}</option>                                {/volist}                            </select>                        </div>                    </div>                    {/if}                    <button type="button" class="btn btn-primary block full-width m-b screen_btn">筛选</button>                </div>            </div>    </div></div><script type="text/javascript" src="__STATIC__/adv/js/plugins/echarts/echarts.min.js"></script><script type="text/javascript" src="__STATIC__/adv/js/plugins/echarts/china.js"></script><script type="text/javascript">    //分布图    var dom = document.getElementById("container");    var myChart = echarts.init(dom);    var app = {};    option = null;    var geoCoordMap = {$geoCoordMap};    var data = {$convertData}    var convertData = function (data) {        var res = [];        for (var i = 0; i < data.length; i++) {            var geoCoord = geoCoordMap[data[i].name];            if (geoCoord) {                res.push({                    name: data[i].name,                    value: geoCoord.concat(data[i].value)                });            }        }        return res;    };    var convertedData = [        convertData(data),        convertData(data.sort(function (a, b) {            return b.value - a.value;        }).slice(0, 7))    ];    option = {        backgroundColor: '#404a59',        animation: true,        animationDuration: 1000,        animationEasing: 'cubicInOut',        animationDurationUpdate: 1000,        animationEasingUpdate: 'cubicInOut',        title: [            {                top:"2%",                text: '全国设备分布图',                // subtext: 'data from PM25.in',                // sublink: 'http://www.pm25.in',                left: 'center',                textStyle: {                    color: '#fff'                }            },            {                id: 'statistic',                right: 120,                top: 40,                width: 100,                textStyle: {                    color: '#fff',                    fontSize: 16                }            }        ],        //右上角的工具        toolbox: {            iconStyle: {                normal: {                    borderColor: '#fff'                },                emphasis: {                    borderColor: '#b1e4ff'                }            },            show:false        },        brush: {            outOfBrush: {                color: '#abc'            },            brushStyle: {                borderWidth: 2,                color: 'rgba(0,0,0,0.2)',                borderColor: 'rgba(0,0,0,0.5)',            },            seriesIndex: [0, 1],            throttleType: 'debounce',            throttleDelay: 300,            geoIndex: 0        },        geo: {            map: 'china',            top:"45%",            left: '36%',            right: '40%',            center: [117.98561551896913, 31.205000490896193],            zoom: 2.8,            label: {                emphasis: {                    show: false                }            },            roam: true,            itemStyle: {                normal: {                    areaColor: '#323c48',                    borderColor: '#111'                },                emphasis: {                    areaColor: '#2a333d'                }            }        },        //悬浮框的数据        tooltip : {            trigger: 'item',            formatter:function(params)//数据格式            {                if(typeof params.data.name !='undefined' && typeof params.value[2] != 'undefined'){                    return params.data.name+': 共有'+params.value[2]+'台设备';                }else{                    return params['name']+': 共有'+params['value']+'台设备';                }            }        },        grid: {            right: 40,            top: 100,            bottom: 40,            width: '30%'        },        xAxis: {            type: 'value',            scale: false,            position: 'top',            boundaryGap: false,            splitLine: {show: false},            axisLine: {show: false},            axisTick: {show: false},            axisLabel: {margin: 2, textStyle: {color: '#aaa'}},        },        yAxis: {            type: 'category',            name: '设备数量(最多显示40个城市)：',            nameGap: 17,            axisLine: {show: false, lineStyle: {color: '#ddd'}},            axisTick: {show: false, lineStyle: {color: '#ddd'}},            axisLabel: {interval: 0, textStyle: {color: '#ddd'}},            data: []        },        //标点数据        series : [            {                name: '城市设备:',                type: 'scatter',                coordinateSystem: 'geo',                data: convertedData[0],                symbolSize: function (val) {                    // return Math.max(val[2] / 10, 8);                    return 10;                },                label: {                    normal: {                        formatter: '{b}',                        position: 'right',                        show: false                    },                    emphasis: {                        show: true                    }                },                itemStyle: {                    normal: {                        color: '#ddb926'                    }                }            },            {                name: '设备最多的城市:',                type: 'effectScatter',                coordinateSystem: 'geo',                data: convertedData[1],                symbolSize: function (val) {                    // return Math.max(val[2] / 10, 8);                    return 20;                },                // showEffectOn: 'render',                showEffectOn: 'render',                rippleEffect: {                    brushType: 'stroke'                },                hoverAnimation: true,                label: {                    normal: {                        formatter: '{b}',                        position: 'right',                        show: true                    }                },                itemStyle: {                    normal: {                        color: '#f4e925',                        shadowBlur: 10,                        shadowColor: '#333'                    }                },                zlevel: 1            },            {                id: 'bar',                zlevel: 2,                type: 'bar',                symbol: 'none',                itemStyle: {                    normal: {                        color: '#ddb926'                    }                },                data: []            }        ]    };    // myChart.on('brushselected', renderBrushed);    myChart.setOption(option);    //    // setTimeout(function () {    //     myChart.dispatchAction({    //         type: 'brush',    //         areas: [    //             {    //                 geoIndex: "all",    //                 brushType: 'polygon',    //                 coordRange: [[119.72,34.85],[119.68,34.85],[119.5,34.84],[119.19,34.77],[118.76,34.63],[118.6,34.6],[118.46,34.6],[118.33,34.57],[118.05,34.56],[117.6,34.56],[117.41,34.56],[117.25,34.56],[117.11,34.56],[117.02,34.56],[117,34.56],[116.94,34.56],[116.94,34.55],[116.9,34.5],[116.88,34.44],[116.88,34.37],[116.88,34.33],[116.88,34.24],[116.92,34.15],[116.98,34.09],[117.05,34.06],[117.19,33.96],[117.29,33.9],[117.43,33.8],[117.49,33.75],[117.54,33.68],[117.6,33.65],[117.62,33.61],[117.64,33.59],[117.68,33.58],[117.7,33.52],[117.74,33.5],[117.74,33.46],[117.8,33.44],[117.82,33.41],[117.86,33.37],[117.9,33.3],[117.9,33.28],[117.9,33.27],[118.09,32.97],[118.21,32.7],[118.29,32.56],[118.31,32.5],[118.35,32.46],[118.35,32.42],[118.35,32.36],[118.35,32.34],[118.37,32.24],[118.37,32.14],[118.37,32.09],[118.44,32.05],[118.46,32.01],[118.54,31.98],[118.6,31.93],[118.68,31.86],[118.72,31.8],[118.74,31.78],[118.76,31.74],[118.78,31.7],[118.82,31.64],[118.82,31.62],[118.86,31.58],[118.86,31.55],[118.88,31.54],[118.88,31.52],[118.9,31.51],[118.91,31.48],[118.93,31.43],[118.95,31.4],[118.97,31.39],[118.97,31.37],[118.97,31.34],[118.97,31.27],[118.97,31.21],[118.97,31.17],[118.97,31.12],[118.97,31.02],[118.97,30.93],[118.97,30.87],[118.97,30.85],[118.95,30.8],[118.95,30.77],[118.95,30.76],[118.93,30.7],[118.91,30.63],[118.91,30.61],[118.91,30.6],[118.9,30.6],[118.88,30.54],[118.88,30.51],[118.86,30.51],[118.86,30.46],[118.72,30.18],[118.68,30.1],[118.66,30.07],[118.62,29.91],[118.56,29.73],[118.52,29.63],[118.48,29.51],[118.44,29.42],[118.44,29.32],[118.43,29.19],[118.43,29.14],[118.43,29.08],[118.44,29.05],[118.46,29.05],[118.6,28.95],[118.64,28.94],[119.07,28.51],[119.25,28.41],[119.36,28.28],[119.46,28.19],[119.54,28.13],[119.66,28.03],[119.78,28],[119.87,27.94],[120.03,27.86],[120.17,27.79],[120.23,27.76],[120.3,27.72],[120.42,27.66],[120.52,27.64],[120.58,27.63],[120.64,27.63],[120.77,27.63],[120.89,27.61],[120.97,27.6],[121.07,27.59],[121.15,27.59],[121.28,27.59],[121.38,27.61],[121.56,27.73],[121.73,27.89],[122.03,28.2],[122.3,28.5],[122.46,28.72],[122.5,28.77],[122.54,28.82],[122.56,28.82],[122.58,28.85],[122.6,28.86],[122.61,28.91],[122.71,29.02],[122.73,29.08],[122.93,29.44],[122.99,29.54],[123.03,29.66],[123.05,29.73],[123.16,29.92],[123.24,30.02],[123.28,30.13],[123.32,30.29],[123.36,30.36],[123.36,30.55],[123.36,30.74],[123.36,31.05],[123.36,31.14],[123.36,31.26],[123.38,31.42],[123.46,31.74],[123.48,31.83],[123.48,31.95],[123.46,32.09],[123.34,32.25],[123.22,32.39],[123.12,32.46],[123.07,32.48],[123.05,32.49],[122.97,32.53],[122.91,32.59],[122.83,32.81],[122.77,32.87],[122.71,32.9],[122.56,32.97],[122.38,33.05],[122.3,33.12],[122.26,33.15],[122.22,33.21],[122.22,33.3],[122.22,33.39],[122.18,33.44],[122.07,33.56],[121.99,33.69],[121.89,33.78],[121.69,34.02],[121.66,34.05],[121.64,34.08]]    //             }    //         ]    //     });    // }, 0);    //点击当前城市获取设备信息    myChart.on('click', function (params) {        var province =  params.name;        console.log(province)        $.ajax({            url:"/index/adv/home/getcitydevice",            contentType: "application/x-www-form-urlencoded; charset=utf-8",            type:"post",            dataType:"json",            data:{                province:province,            },            success:function(result){                var result = $.parseJSON(result);                console.log(result);                if(result.code == 200){                }            },            error:function() {                return false;            }        });        var dataAll = [389, 259, 262, 324, 232, 176, 196, 214, 133, 370];        var yAxisData = ['原因1','原因2','原因3','原因4','原因5','原因6','原因7','原因8','原因9','原因10'];        this.setOption({            title:[                // {text:"投诉原因TOP10",x: '40%', y: '1%',textStyle:{color:"#fff",fontSize:"14"}},                {                    text:"当前城市设备",                    right: 120,                    top: 40,                    width: 100,                    textStyle: {                        color: '#fff',                        fontSize: 16                    }                }            ],            grid: {                right: 40,                top: 100,                bottom: 40,                width: '30%'            },            xAxis: [                {gridIndex: 0, axisTick: {show:false},axisLabel: {show:false},splitLine: {show:false},axisLine: {show:false }},            ],            yAxis: [                {  gridIndex: 0, interval:0,data:yAxisData.reverse(),                    axisTick: {show:false}, axisLabel: {show:true},splitLine: {show:false},                    axisLine: {show:true,lineStyle:{color:"#ddb926"}},                }            ],            series: [                {                    id: 'bar',                    name: '投诉原因TOP10',                    type: 'bar',xAxisIndex: 0,yAxisIndex: 0,barWidth:'45%',                    itemStyle:{normal:{color:'#ddb926'}},                    label:{normal:{show:true, position:"right",textStyle:{color:"#9EA7C4"}}},                    data: dataAll.sort(),                }            ]        });    });    //拖拽选框数据    function renderBrushed(params) {        var mainSeries = params.batch[0].selected[0];        var selectedItems = [];        var categoryData = [];        var barData = [];        var maxBar = 40;        var sum = 0;        var count = 0;        for (var i = 0; i < mainSeries.dataIndex.length; i++) {            var rawIndex = mainSeries.dataIndex[i];            var dataItem = convertedData[0][rawIndex];            var pmValue = dataItem.value[2];            sum += pmValue;            count++;            selectedItems.push(dataItem);        }        selectedItems.sort(function (a, b) {            return a.value[2] - b.value[2];        });        for (var i = 0; i < Math.min(selectedItems.length, maxBar); i++) {            categoryData.push(selectedItems[i].name);            barData.push(selectedItems[i].value[2]);        }        this.setOption({            yAxis: {                data: categoryData            },            xAxis: {                axisLabel: {show: !!count}            },            title: {                id: 'statistic',                text: count ? '选中的城市平均设备: ' + parseInt((sum / count).toFixed(4))+'台' : ''            },            series: {                id: 'bar',                data: barData            }        });    };    if (option && typeof option === "object") {        myChart.setOption(option, true);    }    //设备生产/激活饼状图    var production = {$production};    var active = {$active};    var dom1 = document.getElementById("container1");    var myChart1 = echarts.init(dom1);    option1 = null;    option1 = {        backgroundColor:'rgba(128, 128, 128, 0)',        title : {            text: '设备生产/激活',            // x:'center'            left: 'center',            top: 15,            textStyle: {                color: '#ccc'            }        },        tooltip : {            trigger: 'item',            formatter: "{a} <br/>{b} : {c} ({d}%)"        },        // legend: {        //     orient: 'vertical',        //     left: 'right'        // },        series : [            {                name: '设备生产/激活',                type: 'pie',                radius : '55%',                center: ['50%', '60%'],                data:[                    {value:production, name:'设备生产'},                    {value:active, name:'设备激活'}                ],                itemStyle: {                    emphasis: {                        shadowBlur: 10,                        shadowOffsetX: 0,                        // shadowColor: 'rgba(0, 0, 0, 0.5)'                    }                }            }        ],        color: ['rgb(200,200,169)','rgb(131,175,155)']    };    myChart1.setOption(option1);</script><script src="__STATIC__/adv/js/jquery.min.js?v=2.1.4"></script><script type="text/javascript" src="__STATIC__/adv/layui/layui.all.js"></script><script>    if({$role_id}==1){        //回显查找的厂商型号        if({$querychannel}){            var querychannel = {$querychannel};            var channelarr = querychannel.split(",");            var str = '';            console.log(channelarr)            for(var i=0;i<channelarr.length;i++){                var reg = new RegExp("'","g");                str+="<option value="+channelarr[i]+">"+channelarr[i]+"</option>";            }            console.log(str);            $("#selmanu").append(str);            $("#selmanu").find("option").attr("selected",true);            $("#selmanu").trigger("chosen:updated");        }    }    //通过厂商获取厂商型号    function getmanulist() {        var customer_id = $('#selcustomer option:selected').val();        if(customer_id==''){            $('#selmanu').children().remove();            $("#selmanu").trigger("chosen:updated");            return false;        }        $.ajax({            url:"/index/adv/home/getmanulist",            type:"post",            dataType:"json",            data:{                customer_id:customer_id,            },            success:function(result){                var result = $.parseJSON(result);                var manu = result.content;                $('#selmanu').children().remove();                $("#selmanu").trigger("chosen:updated");                if(result.code == 200){                    var str = '';                    for(var i=0;i<manu.length;i++){                        str+='<option value="'+manu[i].customer+'">'+manu[i].customer+'</option>';                    }                    $('#selmanu').append(str);                    $("#selmanu").trigger("chosen:updated");                }            },            error:function() {                return false;            }        });    }    $('.screen_btn').click(function () {        var customer_text = $('#selcustomer option:selected').text();        var menuval = $('#selmanu option:selected').val();        if(!menuval){            layer.msg('未选择筛选条件！', {icon: 5});            return false;        }        var channel = '';        var channelstr = '';        $('.chosen-choices li').each(function(index) {            if($(this).text()!=''){                channel+='"'+$(this).text()+'"'+','                channelstr+=$(this).text()+',';            }        });        window.location.href = "/index/adv/home/index?querychannel="+channel+'&customer_text='+customer_text+'&channelstr='+channelstr;    })</script><!-- 全局js --><script src="__STATIC__/adv/js/bootstrap.min.js?v=3.3.6"></script><script src="__STATIC__/adv/js/plugins/chosen/chosen.jquery.js"></script><script src="__STATIC__/adv/js/demo/form-advanced-demo.js"></script></body></html>